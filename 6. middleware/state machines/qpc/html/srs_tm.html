<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QP/C: Time Management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="ql-preview.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="ql-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.png"/></a>
  </div>
   <div id="projectname">
    QP/C
    &nbsp;<span id="projectnumber">7.3.4</span>
   </div>
   <div id="projectbrief">Real-Time Embedded Framework</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('srs_tm.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Time Management</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><span class="prev_button"><a class="el" href="srs_emm.html">Event Memory Management</a></span><span class="next_button"><a class="el" href="srs_qs.html">Software Tracing</a></span> </p>
<h1><a class="anchor" id="srs_tm-intro"></a>
Concepts &amp; Definitions</h1>
<p>Time management available in a traditional RTOS includes a delaying a calling task by blocking (<code>delay()</code>) or timed blocking on various kernel objects (e.g., semaphores or event flags). These blocking mechanisms are not very useful in Active Object-based systems where <a class="el" href="srs_ao.html#srs_ao-block">blocking is not allowed</a>. Instead, to be compatible with the <a class="el" href="srs_ao.html#srs_ao-model">Active Object model of computation</a>, time management must be based on the event-driven paradigm in which every interesting occurrence manifests itself as an event instance.</p>
<h2><a class="anchor" id="srs_tm-te"></a>
Time Events</h2>
<p>An event-driven framework like QP manages time through <b>Time Events</b> (sometimes called timers). A Time Event is a UML term and denotes a point in time: At the specified time, the event occurs <a class="el" href="srs.html#srs_ref">[UML 2.5]</a>. The basic usage model of these Time Events is as follows: An Active Object allocates and owns one or more Time Event instances. When the Active Object needs to arrange for a timeout, it <b>arms</b> one of its Time Events to expire in the specified time in the future (one-shot timeout). Active Object might also specify a <em>time-interval</em> to automatically re-arm Time Event to expire periodically (periodic timeouts).</p>
<p>When the specified time arrives, the Time Event <em>expires</em> and QP Framework directly posts the Time Event to the event queue of the owner Active Object. The posting is performed according to the default (FIFO) policy with the event delivery guarantee. For a Time Event armed for one-shot, the Time Event is automatically <b>disarmed</b>. For a Time Event armed for periodic expiration, the Time Event is automatically <b>re-armed</b> to expire in the specified interval.</p>
<h2><a class="anchor" id="srs_tm-tick"></a>
System Clock Tick</h2>
<p>Most real-time systems, including traditional RTOSes and Active Object Frameworks, require a periodic time source called the <b>System Clock Tick</b> to keep track of time delays, timeouts, and Time Events in case of the event-driven QP Framework. The system clock tick is typically a periodic interrupt that occurs at a predetermined rate, typically between 10Hz and 1000Hz. The faster the tick rate, the more overhead the time management implies. The System Clock Tick must call a special function in the QP Framework to give the framework a chance to periodically update the Time Events.</p>
<p><a class="anchor" id="srs_fig-61"></a></p><div class="image">
<object type="image/svg+xml" data="te-periodic.svg" width="1500px" style="pointer-events: none;"></object>
</div>
  <div class="caption"><center><em>Figure SRS-61: Jitter of a periodic Time Event expiring every tick</em></center></div><p><a class="el" href="srs_tm.html#srs_fig-61">Figure SRS-61</a> shows in a somewhat exaggerated manner the various delays of a periodic Time Event armed for one tick interval. As indicated by the varying time intervals, the time event delivery is always subject to jitter. The jitter gets worse as the priority of the recipient Active Object gets lower. In heavily loaded systems, the jitter might even exceed one clock tick period. In particular, a Time Event armed for just one tick might expire almost immediately because the system clock tick is asynchronous with respect to active object execution. To guarantee at least one tick timeout, you need to arm a time event for two clock ticks. Note too that time events are generally not lost due to event queuing. This is in contrast to clock ticks of a traditional RTOS, which can be lost during periods of heavy loading.</p>
<h2><a class="anchor" id="srs_tm-tickless"></a>
"Tickless Mode"</h2>
<p>While a fixed System Clock Tick is very useful, it also has the unfortunate side effect of taking the CPU out of a low power state regardless if real work needs to be done or not. This effect can have a significant negative impact on the power efficiency of the system.</p>
<p>To mitigate that problem, some real-time kernels use the low-power optimization called the "Tickless Mode" (a.k.a. "tick suppression" or "dynamic tick"). In this mode, instead of indiscriminately making the clock tick fire with a fixed period, the kernel adjusts the clock ticks dynamically, as needed. Specifically, after each clock tick the kernel re-calculates the time for the next clock tick and then sets the clock tick interrupt for the earliest timeout it has to wait for. For example, if the shortest timeout the kernel has to attend to is 300 milliseconds into the future, then the clock interrupt will be set for 300 milliseconds.</p>
<p>This approach maximizes the amount of time the CPU can remain asleep, but requires the kernel to perform the additional work to calculate the dynamic tick intervals and to program them into the hardware. This additional bookkeeping adds complexity to the kernel, is often non-deterministic and, most importantly, extends the time CPU spends in the high-power active mode and thus eliminates some of the power gains the "Tickless Mode" was supposed to bring.</p>
<p>Also, the "Tickless Mode" requires a more capable hardware timer that must be able of being reprogrammed for every interrupt in a wide dynamic range and also must accurately keep track of the elapsed time to correct for the irregular (dynamic) tick intervals. Still, "Tickless Mode" often causes a <em>drift</em> in the timing of the clock tick.</p>
<h2><a class="anchor" id="srs_tm-rates"></a>
Multiple Tick Rates</h2>
<p>For the reasons just mentioned, QP Framework does not support "Tickless Mode". Instead, QP Framework supports <b>multiple clock tick rates</b> and provides methods for finding out when a given clock tick rate is not needed for the currently armed Time Events. This allows the QP Application to shut down the not needed clock tick rates.</p>
<p>The support for multiple static clock tick rates is significantly simpler than the "Tickless Mode", and essentially does not increase the complexity of the framework (because the same code for the single tick rate can handle other tick rates the same way). Also, multiple static tick rates require much simpler hardware timers, which can be clocked specifically to the desired tick rate and don't need particularly wide dynamic range. For example, 16-bit timers or even 8-bit timers with or without prescalers are completely adequate. Yet the multiple clock rates can deliver similar low-power performance for the system, while keeping QP framework much simpler and easier to certify than "Tickless" Kernels.</p>
<h1><a class="anchor" id="srs_tm-req"></a>
Requirements</h1>
<p><a id="a72_REQ-QP-06_00" name="a72_REQ-QP-06_00"></a> </p>
<h2><a class="anchor" id="REQ-QP-06_00"></a>
REQ-QP-06_00</h2>
<table class="doxtable">
<tr>
<th>REQ-QP-06_00 </th></tr>
<tr style="text-align:left">
<th>QP Framework shall... </th></tr>
<tr>
<td><b>Description</b><br  />
 TBD... </td></tr>
</table>
<p><span class="prev_button"><a class="el" href="srs_emm.html">Event Memory Management</a></span><span class="next_button"><a class="el" href="srs_qs.html">Software Tracing</a></span>  </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="srs.html">Software Requirements Specification</a></li>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2024 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QP/C 7.3.4</b> &nbsp;|&nbsp; Updated on Thu Mar 21 2024
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2024 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QP/C 7.3.4</b> &nbsp;|&nbsp; Updated on Thu Mar 21 2024
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
