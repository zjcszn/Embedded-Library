<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QP/C: Cooperative Run-to-Completion Kernel</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="ql-preview.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="ql-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.png"/></a>
  </div>
   <div id="projectname">
    QP/C
    &nbsp;<span id="projectnumber">7.3.4</span>
   </div>
   <div id="projectbrief">Real-Time Embedded Framework</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('srs_qv.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Cooperative Run-to-Completion Kernel</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><span class="prev_button"><a class="el" href="srs_qs.html">Software Tracing</a></span><span class="next_button"><a class="el" href="srs_qk.html">Preemptive Run-to-Completion Kernel</a></span> </p>
<h1><a class="anchor" id="srs_qv-theory"></a>
Theory of Operation</h1>
<p>The <a class="el" href="srs_ao.html#srs_ao-def">Active Object</a> model of computation requires the provision of an "execution context" only <em>during</em> the <a class="el" href="srs_ao.html#srs_ao-rtc">RTC (Run-to-Completion) processing</a>. An Active Object that is merely <em>waiting</em> for event(s) does not need an "execution context" at all. This opens up possibility of executing Active Objects sequentially in a single thread (e.g., the <code>main()</code> function in C or C++).</p>
<p><a class="el" href="struct_q_v.html" title="QV non-preemptive, cooperative kernel (QV namespace emulated as a &quot;class&quot; in C)">QV</a> is a simple <b>cooperative</b>, non-preemptive kernel that executes Active Objects to completion one <a class="el" href="srs_ao.html#srs_ao-rtc">RTC step</a> at a time. After every RTC step, the <a class="el" href="struct_q_v.html" title="QV non-preemptive, cooperative kernel (QV namespace emulated as a &quot;class&quot; in C)">QV</a> kernel performs priority-based scheduling that selects the highest-priority Active Object that has an event to process. Due to naturally short <a class="el" href="srs_ao.html#srs_ao-rtc">RTC steps</a>, the simple non-preemptive <a class="el" href="struct_q_v.html" title="QV non-preemptive, cooperative kernel (QV namespace emulated as a &quot;class&quot; in C)">QV</a> kernel is often adequate for many real-time systems.</p>
<p><a class="anchor" id="srs_fig-07_01"></a></p><div class="image">
<img src="srs-qv.png" alt=""/>
</div>
  <div class="caption"><center><em>Figure 07_01: <a class="el" href="struct_q_v.html" title="QV non-preemptive, cooperative kernel (QV namespace emulated as a &quot;class&quot; in C)">QV</a> scheduler operation</em></center></div><p>Please note that because the state machines always return to the <a class="el" href="struct_q_v.html" title="QV non-preemptive, cooperative kernel (QV namespace emulated as a &quot;class&quot; in C)">QV</a> scheduler after each RTC step, a single stack can be used to process all state machines (memory-friendly architecture).</p>
<p>The <a class="el" href="struct_q_v.html" title="QV non-preemptive, cooperative kernel (QV namespace emulated as a &quot;class&quot; in C)">QV</a> scheduler can also very easily detect when all event queues are empty, at which point it can call the idle callback to let the application put the CPU and peripherals to a <b>low-power sleep mode</b> (power-friendly architecture).</p>
<p>Given the simplicity, portability, and low-resource consumption, the <a class="el" href="struct_q_v.html" title="QV non-preemptive, cooperative kernel (QV namespace emulated as a &quot;class&quot; in C)">QV</a> scheduler is very attractive. It allows allows the developer to partition the problem into Active Objects and let these Active Objects cooperate to gain access to the CPU. The thread-level response of the <a class="el" href="struct_q_v.html" title="QV non-preemptive, cooperative kernel (QV namespace emulated as a &quot;class&quot; in C)">QV</a> scheduler is the longest RTC step in the whole system, but because event-driven active objects don't block, the RTC steps tend to be short (typically just a few microseconds). Also, often you can break up longer RTC steps into shorter pieces (multi-stage processing), by posting an event to self and returning ("Reminder" state pattern). The self-posted event then triggers the continuation of longer processing.</p>
<dl class="section remark"><dt>Remarks</dt><dd>Sometimes it is not practical to break up long RTC steps, and consequently the thread-level response of the simple <a class="el" href="struct_q_v.html" title="QV non-preemptive, cooperative kernel (QV namespace emulated as a &quot;class&quot; in C)">QV</a> kernel might be too slow. In this cases you need to use a <em>preemptive</em> kernel. The big advantage of preemptive kernel is that it effectively decouples high-priority thread from low-priority threads in the time domain. The timeliness of execution of high-priority thread is almost independent on the low-priority threads. But of course there is no such thing as a free lunch. Preemptive kernels open the whole new class of problems related to race conditions. So you need to be very careful about sharing any resources.</dd></dl>
<h1><a class="anchor" id="srs_qv-req"></a>
Requirements</h1>
<p><a id="a74_REQ-QP-07_00" name="a74_REQ-QP-07_00"></a> </p>
<h2><a class="anchor" id="REQ-QP-07_00"></a>
REQ-QP-07_00</h2>
<table class="doxtable">
<tr>
<th>REQ-QP-07_00 </th></tr>
<tr style="text-align:left">
<th>QP Framework shall... </th></tr>
<tr>
<td><b>Description</b><br  />
 TBD... </td></tr>
</table>
<p><span class="prev_button"><a class="el" href="srs_qs.html">Software Tracing</a></span><span class="next_button"><a class="el" href="srs_qk.html">Preemptive Run-to-Completion Kernel</a></span>  </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="srs.html">Software Requirements Specification</a></li>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2024 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QP/C 7.3.4</b> &nbsp;|&nbsp; Updated on Thu Mar 21 2024
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2024 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QP/C 7.3.4</b> &nbsp;|&nbsp; Updated on Thu Mar 21 2024
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
